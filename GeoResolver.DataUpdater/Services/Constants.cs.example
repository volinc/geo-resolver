namespace GeoResolver.DataUpdater.Services;

/// <summary>
/// Константы для имен полей в GeoJSON.
/// Использование констант вместо строковых литералов улучшает:
/// - Читаемость кода
/// - Безопасность типов (ошибки компиляции вместо runtime ошибок)
/// - Рефакторинг (изменение в одном месте)
/// </summary>
public static class GeoJsonFieldNames
{
    // ISO codes
    public const string IsoA2 = "ISO_A2";
    public const string IsoA2Lower = "iso_a2";
    public const string IsoA2Eh = "ISO_A2_EH";
    public const string IsoA2EhLower = "iso_a2_eh";
    
    public const string IsoA3 = "ISO_A3";
    public const string IsoA3Lower = "iso_a3";
    public const string Adm0A3 = "ADM0_A3";
    public const string Adm0A3Lower = "adm0_a3";
    
    public const string Iso = "ISO";
    public const string Adm0Iso = "ADM0_ISO";
    public const string Adm0IsoLower = "adm0_iso";
    
    // OSM format
    public const string OsmIso3166Alpha2 = "ISO3166-1:alpha2";
    public const string OsmIso3166Alpha3 = "ISO3166-1:alpha3";
    public const string OsmIso3166 = "ISO3166-1";
    public const string OsmAddrCountry = "addr:country";
    
    // Names
    public const string Name = "name";
    public const string NameLocal = "name_local";
    public const string NameLong = "NAME_LONG";
    public const string NameAscii = "nameascii";
    
    // Region identifiers
    public const string Iso31662 = "ISO_3166_2";
    public const string Iso31662Lower = "iso_3166_2";
    public const string Adm1Code = "ADM1_CODE";
    public const string Adm1CodeLower = "adm1_code";
    public const string Postal = "POSTAL";
    public const string PostalLower = "postal";
    public const string PostalCode = "POSTAL_CODE";
    public const string PostalCodeLower = "postal_code";
    
    // City identifiers
    public const string OsmId = "osm_id";
    
    // Wikidata
    public static readonly string[] WikidataFieldNames = 
    {
        "wikidata",
        "WIKIDATA",
        "wikidataid",
        "WIKIDATAID",
        "wikidata_id",
        "WIKIDATA_ID"
    };
    
    // Special values
    public const string MissingValueIndicator = "-99";
}

/// <summary>
/// Константы для SQL-запросов.
/// Выделение SQL в отдельный класс улучшает:
/// - Читаемость основного кода
/// - Возможность переиспользования запросов
/// - Легче найти и изменить запросы
/// </summary>
public static class SqlQueries
{
    // Countries
    public const string FindCountryByPoint = @"
        SELECT id, iso_alpha2_code, iso_alpha3_code, name_latin, wikidataid, geometry
        FROM countries
        WHERE ST_Contains(geometry, @point)
        LIMIT 1;";
    
    public const string InsertCountry = @"
        INSERT INTO countries (iso_alpha2_code, iso_alpha3_code, name_latin, wikidataid, geometry)
        VALUES (@isoAlpha2Code, @isoAlpha3Code, @name, @wikidataid, ST_GeomFromWKB(@geometry, 4326))
        ON CONFLICT (iso_alpha2_code) DO UPDATE
        SET iso_alpha3_code = EXCLUDED.iso_alpha3_code,
            name_latin = EXCLUDED.name_latin, 
            wikidataid = EXCLUDED.wikidataid,
            geometry = EXCLUDED.geometry;";
    
    public const string InsertCountryFromGeoJson = @"
        INSERT INTO countries (iso_alpha2_code, iso_alpha3_code, name_latin, wikidataid, geometry)
        VALUES (@isoAlpha2Code, @isoAlpha3Code, @name, @wikidataid, ST_GeomFromGeoJSON(@geometryJson))
        ON CONFLICT (iso_alpha2_code) DO UPDATE
        SET iso_alpha3_code = EXCLUDED.iso_alpha3_code,
            name_latin = EXCLUDED.name_latin, 
            wikidataid = EXCLUDED.wikidataid,
            geometry = EXCLUDED.geometry;";
    
    // Regions
    public const string FindRegionByPoint = @"
        SELECT id, identifier, name_latin, country_iso_alpha2_code, country_iso_alpha3_code, wikidataid, name_local, geometry
        FROM regions
        WHERE ST_Contains(geometry, @point)
        LIMIT 1;";
    
    public const string InsertRegion = @"
        INSERT INTO regions (identifier, name_latin, name_local, country_iso_alpha2_code, country_iso_alpha3_code, wikidataid, geometry)
        VALUES (@identifier, @name, @nameLocal, @countryAlpha2Code, @countryAlpha3Code, @wikidataid, ST_GeomFromGeoJSON(@geometryJson))
        ON CONFLICT (identifier) DO UPDATE
        SET country_iso_alpha2_code = EXCLUDED.country_iso_alpha2_code,
            country_iso_alpha3_code = EXCLUDED.country_iso_alpha3_code,
            name_latin = EXCLUDED.name_latin, 
            name_local = EXCLUDED.name_local,
            wikidataid = EXCLUDED.wikidataid,
            geometry = EXCLUDED.geometry;";
    
    // Cities
    public const string FindCityByPoint = @"
        SELECT id, identifier, name_latin, country_iso_alpha2_code, country_iso_alpha3_code, region_identifier, name_local, geometry
        FROM cities
        WHERE ST_Contains(geometry, @point)
        LIMIT 1;";
    
    public const string InsertCity = @"
        INSERT INTO cities (identifier, name_latin, name_local, country_iso_alpha2_code, country_iso_alpha3_code, region_identifier, geometry)
        VALUES (@identifier, @name, @nameLocal, @countryAlpha2Code, @countryAlpha3Code, @regionIdentifier, ST_GeomFromGeoJSON(@geometryJson))
        ON CONFLICT (identifier) DO UPDATE
        SET country_iso_alpha2_code = EXCLUDED.country_iso_alpha2_code,
            country_iso_alpha3_code = EXCLUDED.country_iso_alpha3_code,
            name_latin = EXCLUDED.name_latin, 
            name_local = EXCLUDED.name_local,
            region_identifier = EXCLUDED.region_identifier, 
            geometry = EXCLUDED.geometry;";
    
    // Lookup queries
    public const string LookupAlpha3FromAlpha2 = @"
        SELECT iso_alpha3_code 
        FROM countries 
        WHERE iso_alpha2_code = @alpha2Code 
        LIMIT 1;";
}

/// <summary>
/// Константы для конфигурации импорта.
/// </summary>
public static class ImportConstants
{
    public const int DefaultLogIntervalSeconds = 10;
    public const int DefaultLogIntervalCount = 100;
    public const int DefaultBatchSize = 10000;
    public const int DefaultCommandTimeout = 300;
}
