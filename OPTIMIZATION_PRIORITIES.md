# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ GeoResolver

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ç–∏–ø–æ–≤
**–§–∞–π–ª:** `GeoResolver/GeoLocationService.cs`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö SQL –≤–º–µ—Å—Ç–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤  
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å `ST_GeomFromText(@point, 4326)` –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π `Point`  
**–í—ã–≥–æ–¥–∞:** 
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–Ω–µ—Ç SQL injection)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (PostgreSQL –Ω–µ –ø–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫—É)
- –õ—É—á—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

**–ü—Ä–∏–º–µ—Ä:**
```csharp
// –ë—ã–ª–æ:
var point = $"POINT({longitude} {latitude})";
cmd.Parameters.AddWithValue("point", NpgsqlDbType.Text, point);

// –°—Ç–∞–ª–æ:
var point = new Point(longitude, latitude) { SRID = 4326 };
cmd.Parameters.AddWithValue("point", point);
```

### 2. –í—ã–¥–µ–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –º–µ—Ç–æ–¥–∞ –¥–ª—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
**–§–∞–π–ª:** `GeoResolver/GeoLocationService.cs`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ `FindCountryByPointAsync`, `FindRegionByPointAsync`, `FindCityByPointAsync`  
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å generic –º–µ—Ç–æ–¥ `FindEntityByPointAsync<T>`  
**–í—ã–≥–æ–¥–∞:** 
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ (~60 —Å—Ç—Ä–æ–∫ ‚Üí ~20 —Å—Ç—Ä–æ–∫)
- –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

## üü° –í–∞–∂–Ω—ã–µ (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 3. –í—ã–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –¥–ª—è –∏–º–µ–Ω –ø–æ–ª–µ–π GeoJSON
**–§–∞–π–ª:** `GeoResolver.DataUpdater/Services/DatabaseWriterService.cs`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –∫–æ–¥—É  
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `GeoJsonFieldNames` —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏  
**–í—ã–≥–æ–¥–∞:** 
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤ (–æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏)
- –õ–µ–≥—á–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å
- –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

### 4. –í—ã–¥–µ–ª–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å
**–§–∞–π–ª:** `GeoResolver.DataUpdater/Services/DatabaseWriterService.cs`  
**–ü—Ä–æ–±–ª–µ–º–∞:** SQL-–∑–∞–ø—Ä–æ—Å—ã –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –∫–æ–¥, —Å–ª–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∏ –∏–∑–º–µ–Ω–∏—Ç—å  
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `SqlQueries` —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏  
**–í—ã–≥–æ–¥–∞:** 
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –õ–µ–≥—á–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

### 5. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ DatabaseWriterService –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –∫–ª–∞—Å—Å—ã
**–§–∞–π–ª:** `GeoResolver.DataUpdater/Services/DatabaseWriterService.cs` (~1600 —Å—Ç—Ä–æ–∫)  
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª, —Å–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å  
**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ `CountryWriter`, `RegionWriter`, `CityWriter`  
**–í—ã–≥–æ–¥–∞:** 
- –°–æ–±–ª—é–¥–µ–Ω–∏–µ Single Responsibility Principle
- –õ–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

## üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 6. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ record types –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
**–í—ã–≥–æ–¥–∞:** –ë–æ–ª–µ–µ —è–≤–Ω—ã–µ —Ç–∏–ø—ã –≤–º–µ—Å—Ç–æ –∫–æ—Ä—Ç–µ–∂–µ–π

### 7. –í—ã–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
**–í—ã–≥–æ–¥–∞:** –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 8. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prepared statements
**–í—ã–≥–æ–¥–∞:** –ù–µ–±–æ–ª—å—à–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —á–∞—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 9. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
**–í—ã–≥–æ–¥–∞:** –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤  
**–û—Å—Ç–æ—Ä–æ–∂–Ω–æ:** –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤:** +5-10% —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Prepared statements:** +2-5% –¥–ª—è —á–∞—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** +50-90% –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

### –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
- **–í—ã–¥–µ–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –º–µ—Ç–æ–¥–∞:** -40 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:** –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∫–ª–∞—Å—Å—ã:** –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–¥–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã:** –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å SQL injection

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 1 (1-2 —á–∞—Å–∞)
1. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ç–∏–ø–æ–≤
2. ‚úÖ –í—ã–¥–µ–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –º–µ—Ç–æ–¥–∞ –¥–ª—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –§–∞–∑–∞ 2 (2-3 —á–∞—Å–∞)
3. ‚úÖ –í—ã–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –¥–ª—è –∏–º–µ–Ω –ø–æ–ª–µ–π GeoJSON
4. ‚úÖ –í—ã–¥–µ–ª–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å

### –§–∞–∑–∞ 3 (4-6 —á–∞—Å–æ–≤)
5. ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ DatabaseWriterService –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –∫–ª–∞—Å—Å—ã

### –§–∞–∑–∞ 4 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
6-9. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –ø–æ –æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã - –∫–æ–º–º–∏—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö `*.example`
